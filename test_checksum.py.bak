"""Test packet verification."""

# Test data
test_data = "f70e110100e900"
packet = bytes.fromhex(test_data)

print(f"Packet: {test_data}")
print(f"Bytes: {' '.join([f'{b:02X}' for b in packet])}")

# Calculate checksum (XOR of all bytes except last two)
checksum = 0
for b in packet[:-2]:
    checksum ^= b

# Calculate ADD (sum of all bytes except last one)  
add = sum(packet[:-1]) & 0xFF

print(f"Calculated checksum: 0x{checksum:02X}")
print(f"Expected checksum: 0x{packet[-2]:02X}")
print(f"Calculated add: 0x{add:02X}")
print(f"Expected add: 0x{packet[-1]:02X}")

# Test second packet
print("\n--- Second packet ---")
test_data2 = "f70e118104000000006d08"
packet2 = bytes.fromhex(test_data2)

print(f"Packet: {test_data2}")
print(f"Device ID: 0x{packet2[1]:02X} (Light)")
print(f"Device Num: 0x{packet2[2]:02X} (Room {packet2[2] & 0x0F})")
print(f"Command: 0x{packet2[3]:02X} (State)")
print(f"Data length: {packet2[4]}")

# Checksum calculation
checksum2 = 0
for b in packet2[:-2]:
    checksum2 ^= b
add2 = sum(packet2[:-1]) & 0xFF

print(f"Checksum: calc=0x{checksum2:02X}, expected=0x{packet2[-2]:02X}")
print(f"ADD: calc=0x{add2:02X}, expected=0x{packet2[-1]:02X}")
